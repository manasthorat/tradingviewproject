<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView Candlestick Chart</title>
    <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #chart-container { width: 100%; height: 500px; }
        #controls { margin: 10px; display: flex; gap: 10px; }
        select { padding: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <div id="controls">
        <label for="stock">Select Stock: </label>
        <select id="stock">
            <option value="NIFTY20MAR2523000CE">NIFTY20MAR2523000CE</option>
            <option value="NIFTY20MAR2523000PE">NIFTY20MAR2523000PE</option>
            <option value="NIFTY">NIFTY (NSE)</option>
            <option value="SENSEX">SENSEX (BSE)</option>
        </select>

        <label for="timeframe">Select Timeframe: </label>
        <select id="timeframe">
            <option value="1m">1 Min</option>
            <option value="5m">5 Min</option>
            <option value="15m">15 Min</option>
            <option value="1h">1 Hour</option>
            <option value="1d">1 Day</option>
        </select>
    </div>

    <div id="chart-container"></div>

    <script>
        const chart = LightweightCharts.createChart(document.getElementById("chart-container"), {
            width: window.innerWidth,
            height: 500,
            layout: { backgroundColor: '#ffffff', textColor: '#000000' },
            grid: { vertLines: { color: "#e1e1e1" }, horzLines: { color: "#e1e1e1" } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            priceScale: { borderColor: "#cccccc" },
            timeScale: { borderColor: "#cccccc" },
        });

        const candleSeries = chart.addCandlestickSeries();

        async function fetchData(stock = "NIFTY20MAR2523000CE", timeframe = "1m") {
            try {
                let response = await fetch(`/get_candlestick_data?stock=${stock}&timeframe=${timeframe}`);
                let data = await response.json();
                if (data.error) {
                    console.error("Error fetching data:", data.error);
                } else {
                    candleSeries.setData(data);
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        // Load initial data
        fetchData();

        // Handle selection change
        document.getElementById("stock").addEventListener("change", function () {
            let selectedStock = this.value;
            let selectedTimeframe = document.getElementById("timeframe").value;
            fetchData(selectedStock, selectedTimeframe);
        });

        document.getElementById("timeframe").addEventListener("change", function () {
            let selectedStock = document.getElementById("stock").value;
            let selectedTimeframe = this.value;
            fetchData(selectedStock, selectedTimeframe);
        });
    </script>
</body>
</html>
